<!DOCTYPE html>
<html>

<head>
    <title>タイピングゲーム</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="typing.css" />
    <audio src="./audio/incorrect_sound.mp3" id="missaudio">現環境では音が鳴りません</audio>
    <audio src="./audio/type_sound.mp3" id="correctaudio"></audio>

</head>

<body>
    <div class="wrap">
        <input type="button" id="start_button" value="start" onclick="ready()" style="text-align: center">
        <div id="count"></div>
        <h1>
            <div id="japanese"></div>
        </h1>
        <h2>
            <div id="word"></div>
        </h2>
        <input type="text" id="input-text">
        <div id="scoredis"></div>
    </div>
    <script>
        var wordlist = ["ちょうどしょなのかのよるのことでした。わたしはしんだおとうとのしょさいにはいって、なにかとかれのかきのしたものなどをとりだしては、ひとりものおもいにふけっていました。", "とうきょうのしたまちとやまのてのさかいめといったような、ひどくさかやがけのおおいまちがある。おもてどおりのはんかがいからおれまがってきたものには、べってんちのかんじをあたえる。", "これは、いまから、よねんまえのはなしである。わたしがいずのみしまのしりあいのうちのにかいでいちかをくらし、ろまねすくというしょうせつをかいていたところのはなしである。", "うとうとしたとおもううちにめがさめた。すると、となりのへやでみょうなおとがする。はじめはなんのおともまたどこからくるともはんしかしはけんとうがつかなかったが、きいているうちに、だんだんみみのなかへまとまったかんねんができてきた。", "さむいふゆがほっぽうから、きつねのおやこのすんでいるもりへやってきました。あるあさほらあなからこどものきつねがでようとしましたが、あっとさんでめをおさえながらかあさんぎつねのところへころげてきました。", "まつどよさんはせめんとあけをやっていた。そとのぶぶんはたいしてめだたなかったけれど、あたまのけと、はなのしたは、せめんとではいいろにおおわれていた。かれは、はなのあなにゆびをつっこんで、てっきんこんくりーとのようにはなげをしゃちこばらせている。", "かいちゅうどけいがたんすのむこうがわへおちてひとりでちくたくとうごいておりました。ねずみがみつけてわらいました。ばかだなあ。だれもみるものはないのに、なんだってうごいているんだえ", "あるひのくれがたのことである。ひとりのげにんが、らしょうもんのしたであめやみをまっていた。ひろいもんのしたには、このおとこのほかにだれもいない。ただ、ところどころにぬりのはげた、おおきなえんちゅうに、こおろぎがいっぴきとまっている。", "ふたりのわかいしんしが、すっかりいぎりすのへいたいのかたちをして、ぴかぴかするてっぽうをかついで、しろくまのようないぬをにひきつれて、だいぶやまおくのきのはのかさかさしたとこを、こんなことをいいながら、あるいておりました。"];
        var wordlistJapanese = ["ちょうど初七日の夜のことでした。私は死んだ弟の書斎に入って、何かと彼の書き残したものなどを取り出しては、一人物思いにふけっていました。", "東京の下町と山の手の境目といったような、ひどく坂や崖(がけ)の多い町がある。表通りの繁華街(はんかがい)から折れ曲がってきたものには、別天地(べってんち)の感じを与える。", "これは、いまから、四年前の話である。私が伊豆の三島の知り合いのうちの二階で一夏を暮し、ロマネスクという小説を書いていたところの話である。", "うとうとしたとおもううちに眼が覚めた。すると、隣の室で妙な音がする。はじめは何の音もまたどこから来るとも判然(はんしか)しは見当がつかなかったが、聞いているうちに、だんだん耳の中へ纏(まと)まった観念ができてきた。", "寒い冬が北方から、狐の親子の住んでいる森へやってきました。或(ある)朝(あさ)洞穴(ほらあな)から子供の狐が出ようとしましたが、「あっ」と叫んで眼を抑えながら母さん狐のところへ転げて来ました。", "松戸(まつど)与(よ)三(さん)はセメントあけをやっていた。外の部分はたいして目立たなかったけれど、頭の毛と、鼻の下は、セメントで灰色に覆われていた。彼は、鼻の穴に指を突っ込んで、鉄筋コンクリートのように、鼻毛をしゃちこばらせている。", "懐中時計が箪笥(たんす)の向う側へ落ちて一人でチクタクと動いておりました。鼠(ねずみ)が見つけて笑いました。馬鹿だなあ。誰も見るものはないのに、何だって動いているんだえ", "ある日の暮方(くれがた)の事である。一人の下人が、羅生門(らしょうもん)の下で雨やみを待っていた。広い門の下には、この男のほかに誰もいない。ただ、所々丹(に)塗(ぬ)りの剥(は)げた、大きな円柱に、蟋蟀(こおろぎ)が一匹止まっている。", "二人の若い紳士(しんし)が、すっかりイギリスの兵隊のかたちをして、ぴかぴかする鉄砲をかついで、白熊(しろくま)のようないぬを二匹つれて、だいぶ山奥の木の葉のかさかさしたとこを、こんなことを言いながら、あるいておりました。"];
        var time_limit = 120;
        var readytime = 3;
        var score;
        var correct;
        var mistake;
        var char_num = 0;
        var word_char;
        var random;
        function ready() {
            readytime = 3;
            scoredis.innerHTML = "";
            start_button.style.visibility = "hidden";
            var readytimer = setInterval(function () {
                count.innerHTML = readytime;
                readytime--;
                if (readytime < 0) {
                    clearInterval(readytimer);
                    gameStart();
                }
            }, 1000);
        }
        function gameStart() {
            score = 0.0;
            mistake = 0;
            correct = 0;
            wordDisplay();
            var time_remaining = time_limit;
            var gametimer = setInterval(function () {
                count.innerHTML = "残り時間：" + time_remaining;
                time_remaining--;
                if (time_remaining <= 0) {
                    clearInterval(gametimer);
                    finish();
                }
            }, 1000);
        }
        function wordDisplay() {
            random = Math.floor(Math.random() * wordlist.length);
            word.innerHTML = wordlist[random];
            japanese.innerHTML = wordlistJapanese[random];
            charInsort();
        }
        function charInsort() {
            word_char = wordlist[random].charAt(char_num);
        }
        function finish() {
            score = Math.floor(Math.pow(correct, 2) * Math.pow((correct / (correct + mistake)), 5));
            scoredis.innerHTML = "スコア:" + score + "点" + "<hr>正タイプ数:" + correct + "<br>ミスタイプ数:" + mistake + "<br>正答率" + (correct / (correct + mistake) * 100).toFixed(1) + "%";
            count.innerHTML = "";
            word.innerHTML = "";
            japanese.innerHTML = "";
            start_button.style.visibility = "visible";
            word_char = 0;
            random = 0;
            char_num = 0;
        }
        document.onkeydown = function (e) {
            if (e.keyCode == 189) {
                keyStr = "-";
            } else if (e.keyCode == 188) {
                keyStr = ","
            } else {
                var keyStr = String.fromCharCode(e.keyCode);
                keyStr = keyStr.toLowerCase();
            }
            if (keyStr == word_char) {
                document.getElementById('missaudio').pause();
                document.getElementById('missaudio').currentTime = 0;
                document.getElementById('correctaudio').pause();
                document.getElementById('correctaudio').currentTime = 0;
                document.getElementById('correctaudio').play();
                word.innerHTML = "<span style='color: red;'>" + wordlist[random].substr(0, char_num + 1) + "</span>" + wordlist[random].substr(char_num + 1, wordlist[random].length);
                char_num++;
                correct++;
                charInsort();
            } else {
                document.getElementById('missaudio').pause();
                document.getElementById('missaudio').currentTime = 0;
                document.getElementById('correctaudio').pause();
                document.getElementById('correctaudio').currentTime = 0;
                mistake++;
                document.getElementById('missaudio').play();
            }
            if (char_num == wordlist[random].length) {
                char_num = 0;
                wordDisplay();
            }
        };

    </script>
</body>

</html>